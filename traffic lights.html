<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <style>
        .green {
            background-color: green;
            width: 200px;
            height: 200px;
            margin: 0 auto;
            opacity: 0.3;
            margin-top: 200px;
            border-radius: 50%;
        }

        .red {
            background-color: red;
            width: 200px;
            height: 200px;
            margin: 0 auto;
            opacity: 0.3;
            border-radius: 50%;
        }

        .yellow {
            background-color: yellow;
            width: 200px;
            height: 200px;
            margin: 0 auto;
            opacity: 0.3;
            border-radius: 50%;
        }

        .active {
            opacity: 1;
        }

        .counter {
            text-align: right;
            font-size: 32px;
        }
    </style>
    <title>Document</title>
</head>

<body>
    <main>
        <div class="counter">До смены сигнала {{counter}} секунд</div>
        <div class="green" v-bind:class="{ active: state.green }" ref="green"></div>
        <div class="yellow" v-bind:class="{ active: state.yellow }"></div>
        <div class="red" v-bind:class="{ active: state.red }"></div>
    </main>
    <script>
        let app = new Vue(
            {
                el: 'main',
                data: {
                    state: {
                        red: false,
                        yellow: false,
                        green: false,
                    },
                    redTime: 2000,
                    yellowTime: 3000,
                    greenTime: 4000,
                    counter: '',
                    timeout: '',


                },
                created() {
                    this.state.red = true
                    this.work()
                    this.counter = this.redTime / 1000
                    this.RedtimeCount()


                },


                methods: {
                    beRed() {
                        this.state.red = true
                        this.state.yellow = false
                        this.state.green = false
                    },
                    beGreen() {
                        this.state.red = false
                        this.state.yellow = false
                        this.state.green = true
                    },
                    beYellow() {
                        this.state.red = false
                        this.state.yellow = true
                        this.state.green = false
                    },
                    work() {
                        setTimeout(() => {
                            this.work()

                        }, 2 * this.yellowTime + this.greenTime + this.redTime);


                        setTimeout(() => {
                            this.beYellow()

                        }, this.redTime);


                        setTimeout(() => {
                            this.beGreen()

                        }, this.yellowTime + this.redTime);



                        setTimeout(() => {

                            this.beYellow()
                            clearTimeout(this.timeout)



                        }, this.redTime + this.yellowTime + this.greenTime);



                        setTimeout(() => {
                            this.beRed()

                        }, 2 * this.yellowTime + this.greenTime + this.redTime);


                    },
                    RedtimeCount() {
                        if (this.counter > 0) {
                            this.counter--
                            setTimeout(this.RedtimeCount, 1000)

                        }
                        else {
                            this.counter = this.yellowTime / 1000
                            this.YellowtimeCountafterred()


                        }


                    },
                    YellowtimeCountafterred() {
                        if (this.counter > 0) {
                            this.counter--
                            setTimeout(this.YellowtimeCountafterred, 1000)

                        }
                        else {
                            this.counter = this.greenTime / 1000
                            this.GreentimeCount()
                        }

                    },
                    GreentimeCount() {

                        if (this.counter > 0) {
                            this.counter--
                            setTimeout(this.GreentimeCount, 1000)

                        }
                        else {
                            this.counter = this.yellowTime / 1000
                            this.YellowtimeCountaftergreen()


                        }
                        if (this.counter < 1) {
                            this.greenBlink()



                        }



                    },
                    YellowtimeCountaftergreen() {

                        if (this.counter > 0) {
                            this.counter--
                            setTimeout(this.YellowtimeCountaftergreen, 1000)

                        }
                        else {
                            this.counter = this.redTime / 1000
                            this.RedtimeCount()
                        }


                    },
                    greenBlink() {

                        this.$refs.green.classList.toggle('active')

                        this.timeout = setTimeout(this.greenBlink, 300)



                        //new Proxy(this.state, {
                        //set(target, yellow, val) {
                        //        if (val = true) {
                        //            clearTimeout(timeout)

                        //        }
                        //    }
                        //}
                        //)



                    },





                }
            }
        )


    </script>
</body>

</html>